---
description: >-
  The Extra Horizon File Service handles the storage of (unstructured) files.
  This guide provides a conceptional overview of the File Service and is a
  complement to the API reference documentation.
---

# Files

### Intro

The File Service can be used for file management, which includes the storage of files \(binary data\) and their metadata. The File Service accepts all data types but aims at data that does not adhere to a particular structure, such as images, log files, and zipped files. File retrieval is based on tokens that grant either full or read-only access.

| Tip: We recommend to store structured data as JSON Documents via the Data Service. This allows for the addition of configurable logic.  |
| :--- |


### Information Model

When binary data is stored in a database via the File Service, two objects are generated: A FileMetadata and an associated Token. Together, these objects reference to the actual, stored file.

![](https://lh6.googleusercontent.com/57wSXraHgahKEsh29XM0jfoRPbuuk_UOSj88egLQLoBy6qhxLhAL_1EN99tm4IihtWaySnKDgCysCjTM5VphehfqBu313izxr_mXOL_JEZkmG5eQBT1pJnEyDfL5rkPyJZpT55I=s0)

### Objects and Attributes

#### FileMetadata

The FileMetadata object is uniquely identified by a component within the associated Token object\(s\), i.e. the MongoDB objectId in the tokens.token attribute. This value is generated by the system when a new file is added and is used to reference the binary data stored in the database. The name and tags \(i.e. descriptive keywords\) attributes, which must/can be specified at creation of the FileMetadata object, only serve query purposes. 

Additionally, the File Service derives and stores the following metadata when a new file is added: 

* creatorId: The identifier \(user.id\) of the User making the file storage request,
* mimetype: The MIME type as specified in the request or, if absent, as derived by the user agent \(usually a web browser\),
* size: The file size in bytes \(by performing a byte count\),  
* The time of creation and of the latest update of the FileMetadata object \(timestamps\).

#### Tokens

A Token object contains two attributes, a token and an accessLevel. The actual access token is composed of the unique identifier of the FileMetadata object \(a MongoDB ObjectId\) and a secret \(version 3\) UUID. 

The accessLevel attribute determines whether the token grants full access \(full\) or read-only access \(read\) to the associated FileMetadata and the binary data it represents. The initially generated Token for a file always grants full access and can therefore be used to generate additional \(full access or read-only\) Tokens. 

There is no limit on the number of Tokens that can be associated to a FileMetadata object. A Token is specific for one file. 

### Actions

This section gives an overview of the available File Service endpoints. The full descriptions, including the required accessLevel, permissions and/or scopes, can be found in the API reference documentation.

#### Managing files and their metadata

No permissions are required to upload a file. When a new file is added, the File Serviceâ€™s back-end generates an initial Token that grants full access to the file and its metadata. This Token can be found in the response to the request and must be stored by the client application for future use.

A file can only be removed by use of a full access Token. This action includes deleting the binary data, the FileMetadata object, and all associated Tokens.

* Add a new file: POST / 
* Delete a file: DELETE /{token} 

| For internal developers: During the processing of a POST request to the / endpoint \(Add a new file\), the /{token}/tokens endpoint is called in the background to generate a Token that grants full access.  |
| :--- |


| Note: At the moment, the binary data and associated metadata of a file cannot be updated. |
| :--- |


#### Managing Tokens

Managing the Tokens associated to a FileMetadata object requires a token granting full access to that specific file. This can be the initially returned token or any full access token created later on.

Deleting a \(read-only or full access\) Token object removes the link with the FileMetadata object, which makes the token stored by the client application invalid to access the file. 

* Generate a Token for a file: POST /{token}/tokens
* Delete a Token: DELETE /{token}/tokens/{tokenToAccess}

#### Viewing files and their metadata

With the VIEW\_FILES permission, a list of the available FileMetadata objects \(including their tokens\) can be obtained. On the other hand, one specific file or its metadata can only be accessed by use of a token. However, the tokens attribute of the FileMetaData will not be returned when obtaining access via a token with a read-only accesslevel. 

* List all FileMetadata: GET /
* Retrieve a file: GET /{token}/file
* Get a FileMetadata object: GET /{token}/details

| Warning: With the VIEW\_FILES permission, a user gets access to all attributes of each FileMetadata object in the system, including the tokens. The latter can be used to retrieve or remove the actual file, i.e. the binary data. Granting this permission to a specific Role \(via the User Service\) should therefore be considered carefully. |
| :--- |


#### Back-end Actions

Health Check 

See xxx. &lt; Discuss on central page: applies to all services.&gt;  


Feedback

* The id examples in the createFileResponse schema should be adjusted to avoid confusion. The example for creatorId and objectId \(in token\) are the same, which might make the user think both ids are the same id in a different object. 

Questions

* Use case: Can a customer easily use this to implement a search function? For example, search on file name, but only return the files the user has access to ðŸ¡ª To search all files, do you need the VIEW\_FILES permission in the back end? How do you filter this to find the files for which the customer has a token?
* What is the best way for a client to keep track of which stored tokens belong to which file? The client app itself should keep a list with for example a \(searchable, unique!?\) name/id of files belonging to a certain user?

